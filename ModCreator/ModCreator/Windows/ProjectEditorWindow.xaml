<local:CWindow x:Class="ModCreator.Windows.ProjectEditorWindow"
        x:TypeArguments="localData:ProjectEditorWindowData"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ModCreator.Windows"
        xmlns:localData="clr-namespace:ModCreator.WindowData"
        xmlns:helper="clr-namespace:ModCreator.Helpers"
        xmlns:converter="clr-namespace:ModCreator.Converters"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        mc:Ignorable="d"
        Title="{x:Static helper:ProjectEditorWindowText.ProjectEditorTitle}" 
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        Icon="/Resources/app-icon.png"
        FontFamily="Segoe UI"
        PreviewKeyDown="Window_PreviewKeyDown">

    <Window.Resources>
        <converter:BoolToIconConverter x:Key="BoolToIconConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#FF2E5090" Padding="15" Margin="0" CornerRadius="0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBox Text="{Binding Project.ProjectName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                             FontSize="20" 
                             FontWeight="Bold" 
                             Foreground="White"
                             Background="Transparent"
                             BorderBrush="White"
                             BorderThickness="0,0,0,1"
                             Padding="5,2"
                             CaretBrush="White"/>
                    <TextBlock FontSize="12" Foreground="#FFCCCCCC" Margin="0,5,0,0">
                        <Run Text="{x:Static helper:ProjectEditorWindowText.ProjectIdLabel}"/>
                        <Run Text="{Binding Project.ProjectId, Mode=OneWay}" FontWeight="SemiBold"/>
                    </TextBlock>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="{x:Static helper:ProjectEditorWindowText.Help}" Click="Help_Click" 
                            Style="{StaticResource HeaderButton}" 
                            Width="70"
                            Margin="10,0,0,0"/>
                    <Button Content="{x:Static helper:ProjectEditorWindowText.Save}" Click="Save_Click" 
                            Style="{StaticResource PrimaryButton}" Width="100" Margin="10,0,0,0"/>
                    <Button Content="{x:Static helper:ProjectEditorWindowText.Cancel}" Click="Close_Click" 
                            Style="{StaticResource ActionButton}" Width="100" Margin="10,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Tab Control -->
        <TabControl x:Name="tabControl" Grid.Row="1" Margin="10">
            <!-- Tab 1: Project Info -->
            <TabItem Header="{x:Static helper:ProjectEditorWindowText.TabProjectInfo}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Created and Modified Dates -->
                    <Grid Grid.Row="0" Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="30"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="30"/>
                        <ColumnDefinition Width="120"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <!-- Project ID -->
                    <TextBlock Grid.Column="0" Grid.Row="0"
                        Text="{x:Static helper:ProjectEditorWindowText.ProjectDetailsId}" 
                        FontWeight="SemiBold"
                        FontSize="13"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        Style="{StaticResource LabelText}" 
                        Margin="0,0,15,0"/>
                    <TextBox Grid.Column="2" Grid.Row="0" Grid.ColumnSpan="5"
                        Text="{Binding Project.ProjectId}"
                        IsReadOnly="True"
                        Background="#FFF5F5F5"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Height="32"
                        VerticalContentAlignment="Center"
                        FontSize="13"
                        Padding="8,0"/>

                    <!-- Project Path -->
                    <TextBlock Grid.Column="0" Grid.Row="2"
                        Text="{x:Static helper:ProjectEditorWindowText.ProjectDetailsPath}" 
                        FontWeight="SemiBold"
                        FontSize="13"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        Style="{StaticResource LabelText}" 
                        Margin="0,0,15,0"/>
                    <TextBox Grid.Column="2" Grid.Row="2" Grid.ColumnSpan="5"
                        Text="{Binding Project.ProjectPath}"
                        IsReadOnly="True"
                        Background="#FFF5F5F5"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Height="32"
                        VerticalContentAlignment="Center"
                        FontSize="13"
                        Padding="8,0"/>

                    <!-- Description -->
                    <TextBlock Grid.Column="0" Grid.Row="6"
                        Text="{x:Static helper:ProjectEditorWindowText.ProjectDetailsDescription}" 
                        FontWeight="SemiBold"
                        FontSize="13"
                        VerticalAlignment="Top"
                        HorizontalAlignment="Right"
                        Style="{StaticResource LabelText}" 
                        Margin="0,8,15,0"/>
                    <TextBox Grid.Column="2" Grid.Row="6" Grid.ColumnSpan="5"
                        Text="{Binding Project.Description, UpdateSourceTrigger=PropertyChanged}"
                        Height="100"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        FontSize="13"
                        Padding="8"/>
                    
                    <!-- Author -->
                    <TextBlock Grid.Column="0" Grid.Row="4"
                        Text="{x:Static helper:ProjectEditorWindowText.ProjectDetailsAuthor}" 
                        FontWeight="SemiBold"
                        FontSize="13"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        Style="{StaticResource LabelText}" 
                        Margin="0,0,15,0"/>
                    <TextBox Grid.Column="2" Grid.Row="4" Grid.ColumnSpan="5"
                        Text="{Binding Project.Author, UpdateSourceTrigger=PropertyChanged}"
                        Height="32"
                        VerticalContentAlignment="Center"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        FontSize="13"
                        Padding="8,0"/>
                    
                    <TextBlock Grid.Column="0" Grid.Row="8"
                        Text="{x:Static helper:ProjectEditorWindowText.HeaderCreated}" 
                        FontWeight="SemiBold"
                        FontSize="13"
                        Style="{StaticResource LabelText}" 
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"/>
                    <TextBox Grid.Column="2" Grid.Row="8"
                        Text="{Binding Project.CreatedDate, StringFormat=\{0:yyyy-MM-dd HH:mm:ss\}}"
                        IsReadOnly="True"
                        Background="#FFF5F5F5"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Height="32"
                        VerticalContentAlignment="Center"
                        FontSize="13"
                        Padding="8,0"/>
                    
                    <TextBlock Grid.Column="4" Grid.Row="8"
                        Text="{x:Static helper:ProjectEditorWindowText.HeaderModified}" 
                        FontWeight="SemiBold"
                        FontSize="13"
                        Style="{StaticResource LabelText}" 
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"/>
                    <TextBox Grid.Column="6" Grid.Row="8"
                        Text="{Binding Project.LastModifiedDate, StringFormat=\{0:yyyy-MM-dd HH:mm:ss\}}"
                        IsReadOnly="True"
                        Background="#FFF5F5F5"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Height="32"
                        VerticalContentAlignment="Center"
                        FontSize="13"
                        Padding="8,0"/>

                    <!-- State -->
                    <TextBlock Grid.Column="0" Grid.Row="10"
                        Text="{x:Static helper:ProjectEditorWindowText.HeaderState}" 
                        FontWeight="SemiBold"
                        FontSize="13"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        Style="{StaticResource LabelText}" 
                        Margin="0,0,15,0"/>
                    <TextBox Grid.Column="2" Grid.Row="10" Grid.ColumnSpan="5"
                        Text="{Binding Project.State}"
                        IsReadOnly="True"
                        Background="#FFF5F5F5"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Height="32"
                        VerticalContentAlignment="Center"
                        FontSize="13"
                        Padding="8,0"/>

                    <!-- Title Image -->
                    <Border x:Name="TitleImageContainer" Grid.Column="8" Grid.Row="0" Grid.ColumnSpan="7" Grid.RowSpan="99"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Background="#FFF5F5F5"
                        Padding="5"
                        Cursor="Hand"
                        Width="400"
                        Height="300">
                            <Image Source="{Binding Project.TitleImg, Mode=OneWay}"
                                Stretch="Uniform"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                    </Border>
                </Grid>
                
                <!-- Tab 1 Actions -->
                <StackPanel Grid.Row="1" Margin="10" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="{x:Static helper:ProjectEditorWindowText.OpenInExplorer}" 
                            Click="OpenProjectFolder_Click"
                            Style="{StaticResource ActionButton}" 
                            Width="150"
                            Margin="0,0,5,0"/>
                    <Button Content="{x:Static helper:ProjectEditorWindowText.Refresh}" 
                            Click="RefreshTab_Click"
                            Style="{StaticResource ActionButton}" 
                            Width="100"/>
                </StackPanel>
                </Grid>
            </TabItem>

            <!-- Tab 2: ModConf -->
            <TabItem Header="{x:Static helper:ProjectEditorWindowText.TabModConf}">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Conf List -->
                    <GroupBox Grid.Column="0" Grid.Row="0" Header="{x:Static helper:ProjectEditorWindowText.ConfFiles}" Margin="0,0,10,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Action Buttons -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                                <Button Content="ðŸ“" 
                                        ToolTip="Create Folder"
                                        Click="CreateFolder_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"/>
                                <Button Content="ðŸ—‘ï¸" 
                                        ToolTip="Delete Folder"
                                        Click="DeleteFolder_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"
                                        IsEnabled="{Binding SelectedConfItem.IsFolder, Mode=OneWay}"/>
                                <Button Content="âž•" 
                                        ToolTip="Add Conf"
                                        Click="AddConf_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"/>
                                <Button Content="ðŸ“‹" 
                                        ToolTip="Clone Conf"
                                        Click="CloneConf_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"
                                        IsEnabled="{Binding HasSelectedConfFile, Mode=OneWay}"/>
                                <Button Content="âœï¸" 
                                        ToolTip="Rename Conf"
                                        Click="RenameConf_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"
                                        IsEnabled="{Binding HasSelectedConfFile, Mode=OneWay}"/>
                                <Button Content="âŒ" 
                                        ToolTip="Remove Conf"
                                        Click="RemoveConf_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        IsEnabled="{Binding HasSelectedConfFile, Mode=OneWay}"/>
                            </StackPanel>

                            <TreeView Grid.Row="1" 
                                      Name="tvConfFiles"
                                      ItemsSource="{Binding ConfItems, Mode=OneWay}"
                                      SelectedItemChanged="TreeView_ConfSelectedItemChanged">
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <Setter Property="IsExpanded" Value="True"/>
                                    </Style>
                                </TreeView.ItemContainerStyle>
                                <TreeView.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding IsFolder, Converter={StaticResource BoolToIconConverter}}" 
                                                       FontFamily="Segoe UI Symbol" 
                                                       Margin="0,0,5,0"/>
                                            <TextBlock Text="{Binding Name}" Padding="2"/>
                                        </StackPanel>
                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>
                            </TreeView>
                        </Grid>
                    </GroupBox>

                    <!-- JSON Editor -->
                    <GroupBox Grid.Column="1" Grid.Row="0" Header="{x:Static helper:ProjectEditorWindowText.JsonEditor}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Editor Toolbar -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5" Background="#FFF5F5F5">
                                <Button Content="Search &amp; Replace" 
                                        Click="ReplaceInEditor_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="130"
                                        Height="28"
                                        Margin="0,0,5,0"
                                        Background="#FF4CAF50"
                                        Foreground="White"
                                        IsEnabled="{Binding HasSelectedConfFile, Mode=OneWay}"/>
                                <Button Content="Open in Notepad" 
                                        Click="OpenInNotepad_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="130"
                                        Height="28"
                                        Margin="0,0,5,0"
                                        Background="#FF4CAF50"
                                        Foreground="White"
                                        IsEnabled="{Binding HasSelectedConfFile, Mode=OneWay}"/>
                            </StackPanel>
                            
                            <!-- Replace Panel -->
                            <Border x:Name="replacePanel" 
                                    Grid.Row="1" 
                                    Background="#FFF9F9F9" 
                                    BorderBrush="#FFCCCCCC" 
                                    BorderThickness="0,1,0,1"
                                    Padding="10"
                                    Visibility="Collapsed">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="70"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Find Row -->
                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                               Text="Find:" 
                                               VerticalAlignment="Center" 
                                               Margin="0,0,10,0"/>
                                    <TextBox x:Name="txtFindText" 
                                             Grid.Row="0" Grid.Column="1"
                                             Height="26"
                                             VerticalContentAlignment="Center"
                                             TextChanged="TxtFindText_TextChanged"
                                             PreviewKeyDown="TxtFindText_KeyDown"
                                             Margin="0,0,10,5"/>
                                    <StackPanel Grid.Row="0" Grid.Column="2" 
                                                Orientation="Horizontal">
                                        <Button Content="Find Next" 
                                                Click="FindNext_Click"
                                                Style="{StaticResource ActionButton}"
                                                Width="90"
                                                Height="26"
                                                Margin="0,0,5,5"/>
                                        <Button Content="Close" 
                                                Click="CloseReplacePanel_Click"
                                                Style="{StaticResource ActionButton}"
                                                Width="60"
                                                Height="26"
                                                Margin="0,0,0,5"/>
                                    </StackPanel>
                                    
                                    <!-- Replace Row -->
                                    <TextBlock Grid.Row="1" Grid.Column="0" 
                                               Text="Replace:" 
                                               VerticalAlignment="Center" 
                                               Margin="0,0,10,0"/>
                                    <TextBox x:Name="txtReplaceText" 
                                             Grid.Row="1" Grid.Column="1"
                                             Height="26"
                                             VerticalContentAlignment="Center"
                                             Margin="0,0,10,0"/>
                                    <StackPanel Grid.Row="1" Grid.Column="2" 
                                                Orientation="Horizontal">
                                        <Button Content="Replace" 
                                                Click="ReplaceOne_Click"
                                                Style="{StaticResource ActionButton}"
                                                Width="90"
                                                Height="26"
                                                Margin="0,0,5,0"/>
                                        <Button Content="Replace All" 
                                                Click="ReplaceAll_Click"
                                                Style="{StaticResource ActionButton}"
                                                Width="90"
                                                Height="26"
                                                Background="#FF2196F3"
                                                Foreground="White"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            
                            <!-- AvalonEdit Editor -->
                            <avalonedit:TextEditor x:Name="txtJsonEditor"
                                                   Grid.Row="2"
                                                   FontFamily="Consolas"
                                                   FontSize="12"
                                                   ShowLineNumbers="True"
                                                   IsEnabled="{Binding HasSelectedConfFile, Mode=OneWay}"
                                                   VerticalScrollBarVisibility="Auto"
                                                   HorizontalScrollBarVisibility="Auto"/>
                        </Grid>
                    </GroupBox>
                    
                    <!-- Tab 2 Actions -->
                    <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1" Margin="0,10,0,0" Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="Note: Changes are saved automatically (direct file management)" 
                                   VerticalAlignment="Center"
                                   Foreground="Gray"
                                   FontSize="11"
                                   FontStyle="Italic"
                                   Margin="0,0,15,0"/>
                        <Button Content="{x:Static helper:ProjectEditorWindowText.OpenInExplorer}" 
                                Click="OpenModConfFolder_Click"
                                Style="{StaticResource ActionButton}" 
                                Width="150"
                                Margin="0,0,5,0"/>
                        <Button Content="{x:Static helper:ProjectEditorWindowText.Refresh}" 
                                Click="RefreshTab_Click"
                                Style="{StaticResource ActionButton}" 
                                Width="100"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Tab 3: ModImg -->
            <TabItem Header="{x:Static helper:ProjectEditorWindowText.TabModImg}">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Image List -->
                    <GroupBox Grid.Column="0" Grid.Row="0" Header="{x:Static helper:ProjectEditorWindowText.ImageFiles}" Margin="0,0,10,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Action Buttons -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,5">
                                <Button Content="ðŸ“" 
                                        ToolTip="Create Folder"
                                        Click="CreateImageFolder_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"/>
                                <Button Content="ðŸ—‘ï¸" 
                                        ToolTip="Delete Folder"
                                        Click="DeleteImageFolder_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"
                                        IsEnabled="{Binding SelectedImageItem.IsFolder, Mode=OneWay}"/>
                                <Button Content="ðŸ“¥" 
                                        ToolTip="Import Image"
                                        Click="ImportImage_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"/>
                                <Button Content="ðŸ“¤" 
                                        ToolTip="Export Image"
                                        Click="ExportImage_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        Margin="0,0,2,0"
                                        IsEnabled="{Binding HasSelectedImageFile, Mode=OneWay}"/>
                                <Button Content="âŒ" 
                                        ToolTip="Remove Image"
                                        Click="RemoveImage_Click"
                                        Style="{StaticResource ActionButton}"
                                        Width="30" Height="30"
                                        FontSize="14"
                                        IsEnabled="{Binding HasSelectedImageFile, Mode=OneWay}"/>
                            </StackPanel>

                            <TreeView Grid.Row="1" 
                                      Name="tvImageFiles"
                                      ItemsSource="{Binding ImageItems, Mode=OneWay}"
                                      SelectedItemChanged="TreeView_ImageSelectedItemChanged">
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem">
                                        <Setter Property="IsExpanded" Value="True"/>
                                    </Style>
                                </TreeView.ItemContainerStyle>
                                <TreeView.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding IsFolder, Converter={StaticResource BoolToIconConverter}}" 
                                                       FontFamily="Segoe UI Symbol" 
                                                       Margin="0,0,5,0"/>
                                            <TextBlock Text="{Binding Name}" Padding="2"/>
                                        </StackPanel>
                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>
                            </TreeView>
                        </Grid>
                    </GroupBox>

                    <!-- Image Preview -->
                    <GroupBox Grid.Column="1" Grid.Row="0" Header="{x:Static helper:ProjectEditorWindowText.ImagePreview}">
                        <Image Source="{Binding SelectedImagePath, Mode=OneWay}"
                                Stretch="Uniform"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                    </GroupBox>
                    
                    <!-- Tab 3 Actions -->
                    <StackPanel Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1" Margin="0,10,0,0" Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="Note: Changes are saved automatically (direct file management)" 
                                   VerticalAlignment="Center"
                                   Foreground="Gray"
                                   FontSize="11"
                                   FontStyle="Italic"
                                   Margin="0,0,15,0"/>
                        <Button Content="{x:Static helper:ProjectEditorWindowText.OpenInExplorer}" 
                                Click="OpenModImgFolder_Click"
                                Style="{StaticResource ActionButton}" 
                                Width="150"
                                Margin="0,0,5,0"/>
                        <Button Content="{x:Static helper:ProjectEditorWindowText.Refresh}" 
                                Click="RefreshTab_Click"
                                Style="{StaticResource ActionButton}" 
                                Width="100"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Tab 4: Global Variables -->
            <TabItem Header="{x:Static helper:ProjectEditorWindowText.TabGlobalVariables}">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- View Toggle Buttons -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Button x:Name="btnGridView" Content="ðŸ“Š Grid View" 
                                Click="ToggleGridView_Click"
                                Style="{StaticResource ActionButton}"
                                Background="#FF2E5090"
                                Foreground="White"
                                Width="120"
                                Margin="0,0,5,0"/>
                        <Button x:Name="btnSourceView" Content="ðŸ“ Source View" 
                                Click="ToggleSourceView_Click"
                                Style="{StaticResource ActionButton}"
                                Width="120"/>
                    </StackPanel>

                    <!-- DataGrid View -->
                    <DataGrid x:Name="dgGlobalVariables"
                              Grid.Row="1" 
                              ItemsSource="{Binding GlobalVariables, Mode=TwoWay}"
                              Style="{StaticResource EditableDataGridStyle}"
                              CellStyle="{StaticResource EditableDataGridCellStyle}"
                              ColumnHeaderStyle="{StaticResource EditableDataGridHeaderStyle}"
                              CanUserAddRows="False"
                              RowEditEnding="DataGrid_RowEditEnding"
                              RowHeight="40"
                              ColumnHeaderHeight="48"
                              Margin="0,0,0,10">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{x:Static helper:ProjectEditorWindowText.VariableName}" 
                                                Binding="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="200"
                                                MinWidth="100"/>
                            <DataGridComboBoxColumn Width="150"
                                                    MinWidth="100"
                                                    SelectedValueBinding="{Binding Type, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <DataGridComboBoxColumn.Header>
                                    <TextBlock Text="{x:Static helper:ProjectEditorWindowText.VariableType}"
                                               ToolTip="{x:Static helper:ProjectEditorWindowText.VariableTypeTooltip}"/>
                                </DataGridComboBoxColumn.Header>
                                <DataGridComboBoxColumn.ElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="ItemsSource" Value="{Binding DataContext.VarTypes, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <Setter Property="DisplayMemberPath" Value="Name"/>
                                        <Setter Property="SelectedValuePath" Value="Type"/>
                                        <Setter Property="IsEditable" Value="False"/>
                                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                                    </Style>
                                </DataGridComboBoxColumn.ElementStyle>
                                <DataGridComboBoxColumn.EditingElementStyle>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="ItemsSource" Value="{Binding DataContext.VarTypes, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                        <Setter Property="DisplayMemberPath" Value="Name"/>
                                        <Setter Property="SelectedValuePath" Value="Type"/>
                                        <Setter Property="IsEditable" Value="False"/>
                                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                                    </Style>
                                </DataGridComboBoxColumn.EditingElementStyle>
                            </DataGridComboBoxColumn>
                            <DataGridTextColumn Header="{x:Static helper:ProjectEditorWindowText.VariableValue}" 
                                                Binding="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="250"
                                                MinWidth="150"/>
                            <DataGridTextColumn Header="{x:Static helper:ProjectEditorWindowText.VariableDescription}" 
                                                Binding="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                Width="*"
                                                MinWidth="200"/>
                            <DataGridTemplateColumn Header="{x:Static helper:ProjectEditorWindowText.HeaderActions}" Width="110">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="ðŸ“‹" 
                                                    ToolTip="Clone Variable"
                                                    Click="CloneVariable_Click"
                                                    Tag="{Binding}"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Width="30" Margin="2" Padding="2"/>
                                            <Button Content="ðŸ—‘ï¸" 
                                                    ToolTip="Remove Variable"
                                                    Click="RemoveVariable_Click"
                                                    Tag="{Binding}"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Width="30" Margin="2" Padding="2" Foreground="Red"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Source View (JSON Editor) -->
                    <avalonedit:TextEditor x:Name="txtVariablesSource"
                                           Grid.Row="1"
                                           FontFamily="Consolas"
                                           FontSize="12"
                                           ShowLineNumbers="True"
                                           Visibility="Collapsed"
                                           VerticalScrollBarVisibility="Auto"
                                           HorizontalScrollBarVisibility="Auto"/>

                    <StackPanel Grid.Row="2" Orientation="Horizontal">
                        <Button Content="{x:Static helper:ProjectEditorWindowText.AddVariable}" 
                                Click="AddVariable_Click"
                                Style="{StaticResource ActionButton}"
                                Background="#FF4CAF50" 
                                Foreground="White"
                                Margin="0,0,10,0"/>
                        <Button Content="{x:Static helper:ProjectEditorWindowText.GenerateCode}" 
                                Click="GenerateVariablesCode_Click"
                                Style="{StaticResource PrimaryButton}"
                                Margin="0,0,10,0"/>
                        <TextBlock Text="{x:Static helper:ProjectEditorWindowText.GenerateCodeNote}" 
                                   VerticalAlignment="Center"
                                   Foreground="Gray"
                                   FontSize="11"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Tab 5: ModEvent -->
            <TabItem Header="{x:Static helper:ProjectEditorWindowText.TabModEvent}">
                <Grid Margin="10">
                    <TextBlock Text="{x:Static helper:ProjectEditorWindowText.FeatureComingSoon}" 
                               Foreground="Gray" 
                               FontStyle="Italic"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="#FFF0F0F0" Padding="10,5" BorderBrush="#FFDDDDDD" BorderThickness="0,1,0,0">
            <TextBlock Text="{Binding Project.ProjectPath, Mode=OneWay}" FontSize="11" Foreground="Gray"/>
        </Border>
    </Grid>
</local:CWindow>
